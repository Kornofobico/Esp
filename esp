-- Script feito por Kipressao11 (versão corrigida para preservar emoji/prefixo)
-- Coloque este script em StarterGui (como LocalScript)

-- Cria o ScreenGui (notificação inicial)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "Kipressao11_Notification"
screenGui.ResetOnSpawn = false
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 50)
frame.Position = UDim2.new(0, 10, 1, -60)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Parent = screenGui

local textLabel = Instance.new("TextLabel")
textLabel.Size = UDim2.new(1, -10, 1, 0)
textLabel.Position = UDim2.new(0, 5, 0, 0)
textLabel.BackgroundTransparency = 1
textLabel.Text = "Script feito por Kipressao11"
textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
textLabel.TextScaled = true
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextXAlignment = Enum.TextXAlignment.Left
textLabel.Parent = frame

frame.BackgroundTransparency = 1
textLabel.TextTransparency = 1

for i = 1, 10 do
	frame.BackgroundTransparency = 1 - i * 0.08
	textLabel.TextTransparency = 1 - i * 0.1
	task.wait(0.05)
end

wait(5)

for i = 1, 10 do
	frame.BackgroundTransparency = i * 0.1
	textLabel.TextTransparency = i * 0.1
	task.wait(0.05)
end

screenGui:Destroy()

-- Config ESP
_G.FriendColor = Color3.fromRGB(0, 0, 255)
_G.EnemyColor = Color3.fromRGB(255, 0, 0)
_G.UseTeamColor = true

local Holder = Instance.new("Folder", game.CoreGui)
Holder.Name = "ESP"

local Box = Instance.new("BoxHandleAdornment")
Box.Name = "nilBox"
Box.Size = Vector3.new(1, 2, 1)
Box.Color3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
Box.Transparency = 0.7
Box.ZIndex = 0
Box.AlwaysOnTop = false
Box.Visible = false

local NameTag = Instance.new("BillboardGui")
NameTag.Name = "nilNameTag"
NameTag.Enabled = false
NameTag.Size = UDim2.new(0, 200, 0, 50)
NameTag.AlwaysOnTop = true
NameTag.StudsOffset = Vector3.new(0, 1.8, 0)
local Tag = Instance.new("TextLabel", NameTag)
Tag.Name = "Tag"
Tag.BackgroundTransparency = 1
Tag.Position = UDim2.new(0, -50, 0, 0)
Tag.Size = UDim2.new(0, 300, 0, 20)
Tag.TextSize = 15
Tag.TextColor3 = Color3.new(100 / 255, 100 / 255, 100 / 255)
Tag.TextStrokeColor3 = Color3.new(0 / 255, 0 / 255, 0 / 255)
Tag.TextStrokeTransparency = 0.4
Tag.Text = "nil"
Tag.Font = Enum.Font.SourceSansBold
Tag.TextScaled = false

-- Guardar conexões por jogador para desconectar depois
local connections = {}

local function findCustomNameTextFromCharacter(character)
	-- procura por qualquer BillboardGui/TextLabel dentro do character criado pelo jogo
	for _, child in pairs(character:GetDescendants()) do
		if child:IsA("TextLabel") and child.Text ~= "" then
			return child.Text, child -- retorna o texto e a própria TextLabel (para copiar propriedades se quiser)
		end
	end
	return nil, nil
end

local function safeGetHumanoidDisplayName(character)
	local humanoid = character:FindFirstChildWhichIsA("Humanoid")
	if humanoid and humanoid:GetAttribute("DisplayName") ~= nil then
		-- raramente usado, mas teste atributo caso jogo use
		return humanoid:GetAttribute("DisplayName")
	end
	if humanoid and humanoid.DisplayName then
		return humanoid.DisplayName
	end
	return nil
end

local LoadCharacter = function(v)
	repeat task.wait() until v.Character ~= nil
	local character = v.Character
	local humanoid = character:WaitForChild("Humanoid")
	local vHolder = Holder:FindFirstChild(v.Name)
	if not vHolder then return end
	-- limpa conteúdos anteriores e desconecta conns antigas (safety)
	if connections[v] then
		for _, c in pairs(connections[v]) do
			if c and c.Disconnect then
				pcall(function() c:Disconnect() end)
			end
		end
		connections[v] = nil
	end
	vHolder:ClearAllChildren()

	local b = Box:Clone()
	b.Name = v.Name .. "Box"
	b.Adornee = character
	b.Parent = vHolder

	local t = NameTag:Clone()
	t.Name = v.Name .. "NameTag"
	t.Enabled = true
	t.Parent = vHolder
	local head = character:FindFirstChild("Head")
	t.Adornee = head or character:FindFirstChildWhichIsA("BasePart")
	if not t.Adornee then
		-- sem adorno, limpa e sai
		return
	end

	-- Função que determina o texto a ser mostrado (prioridade)
	local function determineNameText()
		-- 1) tenta Humanoid.DisplayName
		local ok, hd = pcall(function() return safeGetHumanoidDisplayName(character) end)
		if ok and hd and hd ~= "" then
			return hd
		end
		-- 2) tenta Player.DisplayName
		if v.DisplayName and v.DisplayName ~= "" then
			return v.DisplayName
		end
		-- 3) tenta copiar um TextLabel já existente no character (alguns jogos criam sua própria Billboard com emoji)
		local customText = findCustomNameTextFromCharacter(character)
		if customText then
			return customText
		end
		-- 4) fallback para v.Name
		return v.Name
	end

	-- aplica texto inicial
	local nameText = determineNameText()
	t.Tag.Text = nameText

	-- tenta igualar cor de time
	local teamColor = v.TeamColor
	b.Color3 = Color3.new(teamColor.r, teamColor.g, teamColor.b)
	t.Tag.TextColor3 = Color3.new(teamColor.r, teamColor.g, teamColor.b)

	-- esconde o nome padrão do humanoid (se quiser) — caso remova, comente a linha abaixo
	pcall(function()
		character.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
	end)

	-- Conexões para atualizar o texto quando algo mudar
	connections[v] = {}

	-- 1) se Humanoid.DisplayName mudar
	if humanoid then
		local ok, conn = pcall(function()
			return humanoid:GetPropertyChangedSignal("DisplayName"):Connect(function()
				local newText = determineNameText()
				t.Tag.Text = newText
			end)
		end)
		if ok and conn then table.insert(connections[v], conn) end
	end

	-- 2) se Player.DisplayName mudar
	local ok2, conn2 = pcall(function()
		return v:GetPropertyChangedSignal("DisplayName"):Connect(function()
			t.Tag.Text = determineNameText()
		end)
	end)
	if ok2 and conn2 then table.insert(connections[v], conn2) end

	-- 3) se novo Billboard/TextLabel for adicionado no character (jogo pode inserir nome personalizado)
	local ok3, conn3 = pcall(function()
		return character.ChildAdded:Connect(function(child)
			if child:IsA("BillboardGui") or child:IsA("TextLabel") or child:IsA("Folder") then
				-- pequeno delay para permitir que o TextLabel seja preenchido
				task.wait(0.05)
				t.Tag.Text = determineNameText()
			end
		end)
	end)
	if ok3 and conn3 then table.insert(connections[v], conn3) end

	-- 4) se TeamColor mudar (atualiza cor)
	local ok4, conn4 = pcall(function()
		return v:GetPropertyChangedSignal("TeamColor"):Connect(function()
			local tc = v.TeamColor
			b.Color3 = Color3.new(tc.r, tc.g, tc.b)
			t.Tag.TextColor3 = Color3.new(tc.r, tc.g, tc.b)
		end)
	end)
	if ok4 and conn4 then table.insert(connections[v], conn4) end

	-- Atualiza quando Humanoid.Health/MaxHealth mudar (mantive a lógica antiga)
	local Update
	local UpdateNameTag = function()
		if not pcall(function()
			local maxh = math.floor(humanoid.MaxHealth)
			local h = math.floor(humanoid.Health)
		end) then
			if Update and Update.Disconnect then
				Update:Disconnect()
			end
		end
	end
	UpdateNameTag()
	Update = humanoid.Changed:Connect(UpdateNameTag)
	table.insert(connections[v], Update)
end

local UnloadCharacter = function(v)
	-- desconecta e limpa
	if connections[v] then
		for _, c in pairs(connections[v]) do
			pcall(function() c:Disconnect() end)
		end
		connections[v] = nil
	end
	local vHolder = Holder:FindFirstChild(v.Name)
	if vHolder then
		vHolder:ClearAllChildren()
	end
end

local LoadPlayer = function(v)
	local vHolder = Instance.new("Folder", Holder)
	vHolder.Name = v.Name

	v.CharacterAdded:Connect(function()
		pcall(LoadCharacter, v)
	end)
	v.CharacterRemoving:Connect(function()
		pcall(UnloadCharacter, v)
	end)
	v.Changed:Connect(function(prop)
		if prop == "TeamColor" or prop == "DisplayName" then
			UnloadCharacter(v)
			task.wait()
			LoadCharacter(v)
		end
	end)
	-- carrega agora se já tiver personagem
	pcall(LoadCharacter, v)
end

local UnloadPlayer = function(v)
	UnloadCharacter(v)
	local vHolder = Holder:FindFirstChild(v.Name)
	if vHolder then
		vHolder:Destroy()
	end
end

for i,v in pairs(game:GetService("Players"):GetPlayers()) do
	spawn(function() pcall(LoadPlayer, v) end)
end

game:GetService("Players").PlayerAdded:Connect(function(v)
	pcall(LoadPlayer, v)
end)

game:GetService("Players").PlayerRemoving:Connect(function(v)
	pcall(UnloadPlayer, v)
end)

game:GetService("Players").LocalPlayer.NameDisplayDistance = 0

if _G.Reantheajfdfjdgs then
    return
end

_G.Reantheajfdfjdgs = ":suifayhgvsdghfsfkajewfrhk321rk213kjrgkhj432rj34f67df"

local players = game:GetService("Players")
local plr = players.LocalPlayer

function esp(target, color)
    if target.Character then
        if not target.Character:FindFirstChild("GetReal") then
            local highlight = Instance.new("Highlight")
            highlight.RobloxLocked = true
            highlight.Name = "GetReal"
            highlight.Adornee = target.Character
            highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
            highlight.FillColor = color
            highlight.Parent = target.Character
        else
            target.Character.GetReal.FillColor = color
        end
    end
end

while task.wait() do
    for i, v in pairs(players:GetPlayers()) do
        if v ~= plr then
            esp(v, _G.UseTeamColor and v.TeamColor.Color or ((plr.TeamColor == v.TeamColor) and _G.FriendColor or _G.EnemyColor))
        end
    end
end
